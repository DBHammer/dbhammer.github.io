<!DOCTYPE html>
<html lang="en" data-dark="false">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--
  put your analytics (e.g. Google Analytics) tracking code here
-->

  <!--
  put your search engine verification (e.g. Google Search Console) tag here
-->

  






























<meta name="viewport" content="width=device-width, initial-scale=1">

<title>OceanBase对分布式事务的支持能力评测与分析 | DBHammer</title>

<link rel="icon" href="">

<meta name="title" content="OceanBase对分布式事务的支持能力评测与分析">
<meta name="description" content="DaSE, ECNU. The official website of DBHammer, DaSE, ECNU.">

<meta property="og:title" content="OceanBase对分布式事务的支持能力评测与分析">
<meta property="og:site_title" content="DBHammer">
<meta property="og:description" content="DaSE, ECNU. The official website of DBHammer, DaSE, ECNU.">
<meta property="og:url" content="https://dbhammer.github.io">
<meta property="og:image" content="">
<meta property="og:locale" content="en_US">

<meta property="twitter:title" content="OceanBase对分布式事务的支持能力评测与分析">
<meta property="twitter:description" content="DaSE, ECNU. The official website of DBHammer, DaSE, ECNU.">
<meta property="twitter:url" content="https://dbhammer.github.io">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:image" content="">


  <meta name="author" content="瞿璐祎">
  <meta property="og:type" content="article">
  <meta property="og:updated_time" content="2025-07-10T05:59:07+00:00">
  <meta property="article:published_time" content="2022-03-31T00:00:00+00:00">
  <meta property="article:modified_time" content="2025-07-10T05:59:07+00:00">
  <meta name="revised" content="2025-07-10T05:59:07+00:00">


<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "BlogPosting",
      "author": { "@type": "Person", "name": "OceanBase对分布式事务的支持能力评测与分析" },
      "datePublished": "2022-03-31T00:00:00+00:00",
      "dateModified": "2025-07-10T05:59:07+00:00",
    
    "name": "OceanBase对分布式事务的支持能力评测与分析",
    "description": "DaSE, ECNU. The official website of DBHammer, DaSE, ECNU.",
    "headline": "OceanBase对分布式事务的支持能力评测与分析",
    "publisher": {
      "@type": "Organization",
      "logo": { "@type": "ImageObject", "url": "" }
    },
    "url": "https://dbhammer.github.io"
  }
</script>

<link rel="alternate" type="application/rss+xml" href="https://dbhammer.github.io/feed.xml">

  <!-- Google Fonts -->
<!-- automatically get url from fonts used in theme file -->

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?display=swap&&family=Barlow:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600&amp;family=Roboto+Mono:ital,wght@0,200;0,400;0,500;0,600;1,200;1,400;1,500;1,600" rel="stylesheet">

<!-- Font Awesome icons (load asynchronously due to size) -->

<link href="https://use.fontawesome.com/releases/v6.7.0/css/all.css" rel="stylesheet" media="none" onload="this.removeAttribute('media'); this.onload = null;">
<noscript>
  <link href="https://use.fontawesome.com/releases/v6.7.0/css/all.css" rel="stylesheet">
</noscript>

  <!-- third party styles -->
<!-- https://stylishthemes.github.io/Syntax-Themes/pygments/ -->
<link href="https://cdn.jsdelivr.net/gh/StylishThemes/Syntax-Themes/pygments/css-github/pygments-tomorrow-night-eighties.css" rel="stylesheet">

<!-- include all sass in styles folder -->


  
    <link href="/_styles/-theme.css" rel="stylesheet">
  

  
    <link href="/_styles/alert.css" rel="stylesheet">
  

  
    <link href="/_styles/all.css" rel="stylesheet">
  

  
    <link href="/_styles/anchor.css" rel="stylesheet">
  

  
    <link href="/_styles/background.css" rel="stylesheet">
  

  
    <link href="/_styles/banner.css" rel="stylesheet">
  

  
    <link href="/_styles/blog-article.css" rel="stylesheet">
  

  
    <link href="/_styles/body.css" rel="stylesheet">
  

  
    <link href="/_styles/bold.css" rel="stylesheet">
  

  
    <link href="/_styles/button.css" rel="stylesheet">
  

  
    <link href="/_styles/card.css" rel="stylesheet">
  

  
    <link href="/_styles/checkbox.css" rel="stylesheet">
  

  
    <link href="/_styles/citation.css" rel="stylesheet">
  

  
    <link href="/_styles/code.css" rel="stylesheet">
  

  
    <link href="/_styles/cols.css" rel="stylesheet">
  

  
    <link href="/_styles/dark-toggle.css" rel="stylesheet">
  

  
    <link href="/_styles/details.css" rel="stylesheet">
  

  
    <link href="/_styles/feature.css" rel="stylesheet">
  

  
    <link href="/_styles/figure.css" rel="stylesheet">
  

  
    <link href="/_styles/float.css" rel="stylesheet">
  

  
    <link href="/_styles/font.css" rel="stylesheet">
  

  
    <link href="/_styles/footer.css" rel="stylesheet">
  

  
    <link href="/_styles/form.css" rel="stylesheet">
  

  
    <link href="/_styles/gallery.css" rel="stylesheet">
  

  
    <link href="/_styles/grid.css" rel="stylesheet">
  

  
    <link href="/_styles/header.css" rel="stylesheet">
  

  
    <link href="/_styles/heading.css" rel="stylesheet">
  

  
    <link href="/_styles/highlight.css" rel="stylesheet">
  

  
    <link href="/_styles/icon.css" rel="stylesheet">
  

  
    <link href="/_styles/image.css" rel="stylesheet">
  

  
    <link href="/_styles/input.css" rel="stylesheet">
  

  
    <link href="/_styles/link.css" rel="stylesheet">
  

  
    <link href="/_styles/list.css" rel="stylesheet">
  

  
    <link href="/_styles/main.css" rel="stylesheet">
  

  
    <link href="/_styles/member-intro.css" rel="stylesheet">
  

  
    <link href="/_styles/paragraph.css" rel="stylesheet">
  

  
    <link href="/_styles/portrait.css" rel="stylesheet">
  

  
    <link href="/_styles/post-excerpt.css" rel="stylesheet">
  

  
    <link href="/_styles/post-info.css" rel="stylesheet">
  

  
    <link href="/_styles/post-nav.css" rel="stylesheet">
  

  
    <link href="/_styles/quote.css" rel="stylesheet">
  

  
    <link href="/_styles/role.css" rel="stylesheet">
  

  
    <link href="/_styles/rule.css" rel="stylesheet">
  

  
    <link href="/_styles/search-box.css" rel="stylesheet">
  

  
    <link href="/_styles/search-info.css" rel="stylesheet">
  

  
    <link href="/_styles/section.css" rel="stylesheet">
  

  
    <link href="/_styles/table.css" rel="stylesheet">
  

  
    <link href="/_styles/tags.css" rel="stylesheet">
  

  
    <link href="/_styles/textbox.css" rel="stylesheet">
  

  
    <link href="/_styles/tooltip.css" rel="stylesheet">
  

  
    <link href="/_styles/two-col.css" rel="stylesheet">
  

  
    <link href="/_styles/util.css" rel="stylesheet">
  


<!-- include all css in styles folder -->



  <!-- third party scripts -->
<script src="https://unpkg.com/@popperjs/core@2" defer></script>
<script src="https://unpkg.com/tippy.js@6" defer></script>
<script src="https://unpkg.com/mark.js@8" defer></script>

<!-- include all js in scripts folder -->


  <script src="/_scripts/anchors.js"></script>

  <script src="/_scripts/dark-mode.js"></script>

  <script src="/_scripts/fetch-tags.js"></script>

  <script src="/_scripts/search.js"></script>

  <script src="/_scripts/site-search.js"></script>

  <script src="/_scripts/table-wrap.js"></script>

  <script src="/_scripts/tooltip.js"></script>

  <script src="/_scripts/tooltips.js"></script>

  <script src="/_scripts/true-hide.js"></script>

  <script src="/_scripts/util.js"></script>


</head>

  <body>
    







<header class="background" style="--image: url('')" data-dark="true">
  <a href="/" class="home">
    
      <span class="logo">
        
          <svg xmlns="http://www.w3.org/2000/svg" viewbox="-50 -50 100 100" style="overflow: visible">
  <style>
  circle {
    animation: float 2s ease-out forwards infinite,
    fade 2s ease-out forwards infinite;
  }
  circle:nth-of-type(1) {
    animation-delay: 0.1s;
  }
  circle:nth-of-type(2) {
    animation-delay: 0.4s;
  }
  circle:nth-of-type(3) {
    animation-delay: 1.1s;
  }
  @keyframes float {
    50% {
      transform: translateY(0);
    }
    100% {
      transform: translateY(-45px);
    }
  }
  @keyframes fade {
    75% {
      opacity: 1;
    }
    100% {
      opacity: 0;
    }
  }
  </style>
  <circle fill="#b3e5fc" cx="0" cy="0" r="3"></circle>
  <circle fill="#b3e5fc" cx="0" cy="0" r="3"></circle>
  <circle fill="#b3e5fc" cx="0" cy="0" r="3"></circle>
  <path fill="#81d4fa" d="
      M 0.0 -15.0
      L -21.7 -2.5
      L -21.7 22.5
      L -0.0 35.0
      L 21.7 22.5
      L 21.7 -2.5
      z
    "></path>
  <path fill="#b3e5fc" d="
      M 0.0 -15.0
      L -21.7 -2.5
      L 0 10
      L 21.7 -2.5
      z
    "></path>
  <path fill="none" stroke="#ffffff" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" d="
      M -15 -43
      L -10 -43
      L -10 -19.2
      L -30.3 -7.5
      L -30.3 27.5
      L -0 45
      L 30.3 27.5
      L 30.3 -7.5
      L 10 -19.2
      L 10 -43
      L 15 -43
    "></path>
</svg>

        
      </span>
    
    
      <span class="title-text" data-tooltip="Home">
        
          <span class="title">DBHammer</span>
        
        
          <span class="subtitle">DaSE, ECNU</span>
        
      </span>
    
  </a>

  <input class="nav-toggle" type="checkbox" aria-label="show/hide nav">

  <nav>
    
    
      
        <a href="/project/" data-tooltip="Software, datasets, and more">
          项目
        </a>
      
    
      
        <a href="/blog/" data-tooltip="Musings and miscellany">
          博客
        </a>
      
    
      
        <a href="/research/" data-tooltip="Published works">
          论文
        </a>
      
    
      
        <a href="/news/" data-tooltip="News">
          新闻
        </a>
      
    
      
        <a href="/team/" data-tooltip="About our team">
          成员
        </a>
      
    
      
        <a href="/contact/" data-tooltip="Email, address, and location">
          就业去向
        </a>
      
    
  </nav>
</header>

    <main>
      <!--
  modify main content of page:
  - add section breaks
  - attach section properties
  - filter out blank sections
-->






  
  
  

  <section class="background" data-size="1">
    <!--
  background: ;
  dark: ;
  size: 1;
-->


<h1 class="center">OceanBase对分布式事务的支持能力评测与分析</h1>

<div class="post-info">
  
    
    
      



<div class="portrait-wrapper">
  <a href="/members/%E7%9E%BF%E7%92%90%E7%A5%8E.html" class="portrait" data-style="tiny" aria-label="瞿璐祎">
    
      <i class="icon fas fa-user-graduate"></i>
    

    <img src="/photos/quluyi.jpg" class="portrait-image" alt="member portrait" loading="lazy" onerror="this.src = '/images/fallback.svg'; this.onerror = null;">

    
      <span class="portrait-name">
        瞿璐祎
      </span>
    

    
      <span class="portrait-description">
        
      </span>
    

    
  </a>
</div>

    
  

  
  

  
    <span data-tooltip="Originally published on">
      <i class="icon fa-regular fa-calendar"></i>
      <span>March 31, 2022</span>
    </span>
  

  
    <span data-tooltip="Last updated on">
      <i class="icon fa-solid fa-clock-rotate-left"></i>
      <span>July 10, 2025</span>
    </span>
  
</div>


  


  <div class="tags" data-link="/blog">
    
      <a href='blog?search="tag:%20join"' class="tag" data-tooltip='Show items with the tag "join"'>
        join
      </a>
    
  </div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<h2 id="一目的">一、目的</h2>

<ul>
  <li>分布式数据库的一大设计目标是通过增加分布式节点来提高数据库的性能，如吞吐。但是分布式环境给事务处理带来的优势有可能会由于分布式事务的产生而削弱，甚至会造成性能的恶化。本文主要评测OceanBase对分布式事务的支持能力以及OceanBase提出的tablegroup技术对分布式事务执行性能产生的影响。</li>
</ul>

<h2 id="二初探tpc-c中neworder事务">二、初探TPC-C中NewOrder事务</h2>

<ul>
  <li>
    <p>在<em>TPC-C</em>中，<em>NewOrder</em>事务负责下订单任务，它会在<em>Stock</em>表中更新5-15个items的库存。<em>NewOrder</em>事务会有1%的概率更新远程的仓库的<em>Stock</em>信息，因此会产生1%的分布式事务。<em>NewOrder</em>的事务模板如下所示。</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">TX</span><span class="p">[</span><span class="n">NewOrder</span><span class="p">]</span>
<span class="k">SELECT</span> <span class="n">C_DISCOUNT</span><span class="p">,</span> <span class="n">C_LAST</span><span class="p">,</span> <span class="n">C_CREDIT</span> <span class="k">FROM</span> <span class="n">CUSTOMER</span> <span class="k">WHERE</span> <span class="n">C_W_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">C_D_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">C_ID</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">W_TAX</span> <span class="k">FROM</span> <span class="n">WAREHOUSE</span> <span class="k">WHERE</span> <span class="n">W_ID</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">D_NEXT_O_ID</span><span class="p">,</span> <span class="n">D_TAX</span> <span class="k">FROM</span> <span class="n">DISTRICT</span> <span class="k">WHERE</span> <span class="n">D_W_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">D_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">FOR</span> <span class="k">UPDATE</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">DISTRICT</span> <span class="k">SET</span> <span class="n">D_NEXT_O_ID</span> <span class="o">=</span> <span class="n">D_NEXT_O_ID</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">WHERE</span> <span class="n">D_W_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">D_ID</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">OORDER</span> <span class="p">(</span><span class="n">O_ID</span><span class="p">,</span> <span class="n">O_D_ID</span><span class="p">,</span> <span class="n">O_W_ID</span><span class="p">,</span> <span class="n">O_C_ID</span><span class="p">,</span> <span class="n">O_ENTRY_D</span><span class="p">,</span> <span class="n">O_OL_CNT</span><span class="p">,</span> <span class="n">O_ALL_LOCAL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span> <span class="p">,</span> <span class="o">?</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">NEW_ORDER</span> <span class="p">(</span><span class="n">NO_O_ID</span><span class="p">,</span> <span class="n">NO_D_ID</span><span class="p">,</span> <span class="n">NO_W_ID</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">);</span>
<span class="n">Multiple</span>
<span class="k">SELECT</span> <span class="n">I_PRICE</span><span class="p">,</span> <span class="n">I_NAME</span><span class="p">,</span> <span class="n">I_DATA</span> <span class="k">FROM</span> <span class="n">ITEM</span> <span class="k">WHERE</span> <span class="n">I_ID</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span> <span class="n">C_DISCOUNT</span>
<span class="k">SELECT</span> <span class="n">S_QUANTITY</span><span class="p">,</span> <span class="n">S_DATA</span><span class="p">,</span> <span class="n">S_DIST_01</span><span class="p">,</span> <span class="n">S_DIST_02</span><span class="p">,</span> <span class="n">S_DIST_03</span><span class="p">,</span> <span class="n">S_DIST_04</span><span class="p">,</span> <span class="n">S_DIST_05</span><span class="p">,</span> <span class="n">S_DIST_06</span><span class="p">,</span> <span class="n">S_DIST_07</span><span class="p">,</span> <span class="n">S_DIST_08</span><span class="p">,</span> <span class="n">S_DIST_09</span><span class="p">,</span> <span class="n">S_DIST_10</span> <span class="k">FROM</span> <span class="n">STOCK</span> <span class="k">WHERE</span> <span class="n">S_I_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">S_W_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">FOR</span> <span class="k">UPDATE</span><span class="p">;</span>
<span class="o">//</span><span class="err">此处有</span><span class="mi">1</span><span class="o">%</span><span class="err">的可能</span><span class="n">s_w_id</span> <span class="o">!=</span> <span class="n">w_id</span><span class="err">，从而产生分布式事务</span>
<span class="k">UPDATE</span> <span class="n">STOCK</span> <span class="k">SET</span> <span class="n">S_QUANTITY</span> <span class="o">=</span> <span class="o">?</span><span class="p">,</span> <span class="n">S_YTD</span> <span class="o">=</span> <span class="n">S_YTD</span> <span class="o">+</span> <span class="o">?</span><span class="p">,</span> <span class="n">S_ORDER_CNT</span> <span class="o">=</span> <span class="n">S_ORDER_CNT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">S_REMOTE_CNT</span> <span class="o">=</span> <span class="n">S_REMOTE_CNT</span> <span class="o">+</span> <span class="o">?</span> <span class="k">WHERE</span> <span class="n">S_I_ID</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> <span class="n">S_W_ID</span> <span class="o">=</span> <span class="o">?</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">ORDER_LINE</span> <span class="p">(</span><span class="n">OL_O_ID</span><span class="p">,</span> <span class="n">OL_D_ID</span><span class="p">,</span> <span class="n">OL_W_ID</span><span class="p">,</span> <span class="n">OL_NUMBER</span><span class="p">,</span> <span class="n">OL_I_ID</span><span class="p">,</span> <span class="n">OL_SUPPLY_W_ID</span><span class="p">,</span> <span class="n">OL_QUANTITY</span><span class="p">,</span> <span class="n">OL_AMOUNT</span><span class="p">,</span> <span class="n">OL_DIST_INFO</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">);</span>
<span class="n">EndMultiple</span>
<span class="n">EndTX</span> 
</code></pre></div>    </div>
  </li>
  <li>
    <p>为了分析OceanBase对分布式事务的支持能力，我们将分布式事务比例进行参数化，将它分别设为1%，10%，20%，40%，80%和100%。关于BenchmarkSQL的代码修改见实验配置。</p>
  </li>
</ul>

<h2 id="三实验准备">三、实验准备</h2>

<ul>
  <li>(必选) BenchmarkSQL运行TPC-C中的NewOrder事务，为了合理设置分布式事务比例，对NewOrder事务做了略微的改动，改动内容以及benchmarkSQL的配置参数在下方。</li>
  <li>（必须）OceanBase v3.1.2版本</li>
</ul>

<h2 id="四实验配置">四、实验配置</h2>

<h3 id="1-机器配置">1. 机器配置</h3>

<ul>
  <li>
    <p>为测试分布式事务的影响，本次实验将OceanBase部署在10台机器上。其中9台机器的配置为：8核CPU，32G内存，上面各部署了一个OBServer；其中1台机器的配置为：16核CPU, 16G内存，上面部署了一个OBProxy，同时也作为实验的客户端。</p>
  </li>
  <li>下面介绍了我们的集群配置情况，对BenchmarkSQL修订的内容和配置文件。运行BenchmarkSQL对OceanBase的系统变量和用户变量的调整见官网。</li>
  <li>本实验中使用的是mysql mode，需要将BenchmarkSQL和OceanBase适配，可见官网。</li>
</ul>

<h3 id="2-oceanbase集群配置">2. OceanBase集群配置</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">## Only need to configure when remote login is required</span>
user:
  username: xxx
  password: xxx
  <span class="c">#key_file: .ssh/authorized_keys</span>
oceanbase-ce:
  servers:
    - name: host1
      ip: 10.24.14.8
    - name: host2
      ip: 10.24.14.136
    - name: host3
      ip: 10.24.14.75
    - name: host4
      ip: 10.24.14.178
    - name: host5
      ip: 10.24.14.60
    - name: host6
      ip: 10.24.14.120
    - name: host7
      ip: 10.24.14.126
    - name: host8
      ip: 10.24.14.171
    - name: host9
      ip: 10.24.14.181
  global:
    devname: eth0
    cluster_id: 1
    memory_limit: 28G
    system_memory: 8G
    stack_size: 512K
    cpu_count: 16
    cache_wash_threshold: 1G
    __min_full_resource_pool_memory: 268435456
    workers_per_cpu_quota: 10
    schema_history_expire_time: 1d
    net_thread_count: 4
    major_freeze_duty_time: Disable
    minor_freeze_times: 10
    enable_separate_sys_clog: 0
    enable_merge_by_turn: FALSE
    datafile_disk_percentage: 35
    syslog_level: WARN
    enable_syslog_recycle: <span class="nb">true
    </span>max_syslog_file_count: 4
    appname: ob209
  host1:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data/obdata
    zone: zone0
  host2:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data/obdata
    zone: zone0
  host3:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data/obdata
    zone: zone0
  host4:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data/obdata
    zone: zone1
  host5:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data/obdata
    zone: zone1
  host6:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data1/obdata
    zone: zone1
  host7:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data1/obdata
    zone: zone2
  host8:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data1/obdata
    zone: zone2
  host9:
    mysql_port: 2883
    rpc_port: 2882
    home_path: /data1/obdata
    zone: zone2

obproxy:
  servers:
    - 10.24.14.215
  global:
    listen_port: 2883
    home_path: /data/obproxy
    rs_list: 10.24.14.8:2883<span class="p">;</span>10.24.14.136:2883<span class="p">;</span>10.24.14.75:2883<span class="p">;</span>10.24.14.178:2883<span class="p">;</span>10.24.14.60:2883<span class="p">;</span>10.24.14.120:2883<span class="p">;</span>10.24.14.126:2883<span class="p">;</span>10.24.14.171:2883<span class="p">;</span>10.24.14.181:2883
    enable_cluster_checkout: <span class="nb">false
    </span>cluster_name: ob209
</code></pre></div></div>
<h3 id="3-benchmarksql修改内容和配置文件">3. BenchmarkSQL修改内容和配置文件</h3>

<h4 id="31-benchmarksql下载链接">3.1 BenchmarkSQL下载链接</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">benchmarksql</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">download</span>
</code></pre></div></div>
<h4 id="32-benchmarksql修改内容">3.2 BenchmarkSQL修改内容</h4>

<ul>
  <li>
    <p>修改benchmark-5.0/src/client/jTPCC.java 文件，增加分布式事务比例的参数化</p>

    <div class="language-java highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="kd">private</span> <span class="kt">double</span> <span class="n">tpmC</span><span class="o">;</span>
 <span class="kd">private</span> <span class="n">jTPCCRandom</span> <span class="n">rnd</span><span class="o">;</span>
 <span class="kd">private</span> <span class="nc">OSCollector</span> <span class="n">osCollector</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
 <span class="c1">//声明neworder事务中的分布式事务比例</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kt">double</span> <span class="n">newOrderDistributedRate</span><span class="o">;</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nc">String</span>  <span class="n">iWarehouses</span>  <span class="o">=</span> <span class="n">getProp</span><span class="o">(</span><span class="n">ini</span><span class="o">,</span><span class="s">"warehouses"</span><span class="o">);</span>
 <span class="nc">String</span>  <span class="n">iTerminals</span>  <span class="o">=</span> <span class="n">getProp</span><span class="o">(</span><span class="n">ini</span><span class="o">,</span><span class="s">"terminals"</span><span class="o">);</span>
 <span class="c1">//获取配置文件参数</span>
 <span class="n">newOrderDistributedRate</span> <span class="o">=</span> <span class="nc">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">getProp</span><span class="o">(</span><span class="n">ini</span><span class="o">,</span> <span class="s">"newOrderDistributedRate"</span><span class="o">));</span>
     
 <span class="nc">String</span>  <span class="n">iRunTxnsPerTerminal</span> <span class="o">=</span> <span class="n">ini</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"runTxnsPerTerminal"</span><span class="o">);</span>
 <span class="nc">String</span> <span class="n">iRunMins</span>  <span class="o">=</span>  <span class="n">ini</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"runMins"</span><span class="o">);</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getFileNameSuffix</span><span class="o">()</span>
 <span class="o">{</span>
 	<span class="nc">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyyMMddHHmmss"</span><span class="o">);</span>
 	<span class="k">return</span> <span class="n">dateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="o">());</span>
     <span class="o">}</span>
     
 <span class="c1">//创建外部类的访问接口</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">getNewOrderDistributedRate</span><span class="o">()</span> <span class="o">{</span>
 		<span class="k">return</span> <span class="n">newOrderDistributedRate</span><span class="o">;</span>
 	<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li>
    <p>修改benchmark-5.0/src/client/jTPCCTData.java 文件，修改NewOrder的分布式事务比例</p>

    <div class="language-java highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">o_ol_cnt</span><span class="o">)</span>                    <span class="c1">// 2.4.1.5</span>
	<span class="o">{</span>
	  <span class="n">newOrder</span><span class="o">.</span><span class="na">ol_i_id</span><span class="o">[</span><span class="n">i</span><span class="o">]</span>         <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="na">getItemID</span><span class="o">();</span>
		<span class="c1">//更改分布式事务比例</span>
	   <span class="k">if</span> <span class="o">(</span><span class="n">rnd</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="o">-</span><span class="n">jTPCC</span><span class="o">.</span><span class="na">getNewOrderDistributedRate</span><span class="o">()*</span><span class="mi">100</span><span class="o">)</span>
		<span class="n">newOrder</span><span class="o">.</span><span class="na">ol_supply_w_id</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">terminalWarehouse</span><span class="o">;</span>
	    <span class="k">else</span>
		<span class="n">newOrder</span><span class="o">.</span><span class="na">ol_supply_w_id</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">numWarehouses</span><span class="o">);</span>
	    <span class="n">newOrder</span><span class="o">.</span><span class="na">ol_quantity</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">rnd</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
     
</code></pre></div>    </div>
  </li>
</ol>

<ul>
  <li>
    <p>修改benchmark-5.0/run/probs.ob文件</p>

    <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code> <span class="nv">db</span><span class="o">=</span>oracle
 <span class="nv">driver</span><span class="o">=</span>com.alipay.oceanbase.obproxy.mysql.jdbc.Driver
 <span class="nv">conn</span><span class="o">=</span>jdbc:oceanbase://10.24.14.188:2883/tpcc_100?useUnicode<span class="o">=</span><span class="nb">true</span>&amp;characterEncoding<span class="o">=</span>utf-8
 <span class="nv">user</span><span class="o">=</span>tpcc@test
 <span class="nv">password</span><span class="o">=</span>
     
 <span class="nv">warehouses</span><span class="o">=</span>100
 <span class="nv">loadWorkers</span><span class="o">=</span>30
     
 <span class="nv">terminals</span><span class="o">=</span>100
 //To run specified transactions per terminal- runMins must equal zero
 <span class="nv">runTxnsPerTerminal</span><span class="o">=</span>0
 //To run <span class="k">for </span>specified minutes- runTxnsPerTerminal must equal zero
 <span class="nv">runMins</span><span class="o">=</span>5
 //Number of total transactions per minute
 <span class="nv">limitTxnsPerMin</span><span class="o">=</span>0
     
 //将生成的数据放在该目录
 <span class="nv">fileLocation</span><span class="o">=</span>/data/ob/tpcc_100/
     
 //Distributed Transaction Ratio For NewOrder Transaction
 <span class="nv">newOrderDistributedRate</span><span class="o">=</span>0.01
     
 //Set to <span class="nb">true </span>to run <span class="k">in </span>4.x compatible mode. Set to <span class="nb">false </span>to use the
 //entire configured database evenly.
 <span class="nv">terminalWarehouseFixed</span><span class="o">=</span><span class="nb">false</span>
     
 //The following five values must add up to 100
 <span class="nv">newOrderWeight</span><span class="o">=</span>100
 <span class="nv">paymentWeight</span><span class="o">=</span>0
 <span class="nv">orderStatusWeight</span><span class="o">=</span>0
 <span class="nv">deliveryWeight</span><span class="o">=</span>0
 <span class="nv">stockLevelWeight</span><span class="o">=</span>0
     
 // Directory name to create <span class="k">for </span>collecting detailed result data.
 // Comment this out to suppress.
 <span class="nv">resultDirectory</span><span class="o">=</span>my_result_%tY-%tm-%td_%tH%tM%tS
 <span class="nv">osCollectorScript</span><span class="o">=</span>./misc/os_collector_linux.py
 <span class="nv">osCollectorInterval</span><span class="o">=</span>1
     
</code></pre></div>    </div>
  </li>
  <li>
    <p>修改benchmark-5.0/run/sql.oceanbase/tableCreates.sql 文件</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_config</span> <span class="p">(</span>
     <span class="n">cfg_name</span>    <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
     <span class="n">cfg_value</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
   <span class="p">);</span>
     
   <span class="k">create</span> <span class="n">tablegroup</span> <span class="n">tpcc_group</span> <span class="n">binding</span> <span class="k">true</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_warehouse</span> <span class="p">(</span>
     <span class="n">w_id</span>        <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">w_ytd</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">w_tax</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
     <span class="n">w_name</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
     <span class="n">w_street_1</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">w_street_2</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">w_city</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">w_state</span>     <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">w_zip</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
     <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">w_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_district</span> <span class="p">(</span>
     <span class="n">d_w_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">d_id</span>         <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">d_ytd</span>        <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">d_tax</span>        <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
     <span class="n">d_next_o_id</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">d_name</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
     <span class="n">d_street_1</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">d_street_2</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">d_city</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">d_state</span>      <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">d_zip</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">d_w_id</span><span class="p">,</span> <span class="n">d_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">d_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_customer</span> <span class="p">(</span>
     <span class="n">c_w_id</span>         <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">c_d_id</span>         <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">c_id</span>           <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">c_discount</span>     <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
     <span class="n">c_credit</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_last</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
     <span class="n">c_first</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
     <span class="n">c_credit_lim</span>   <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_balance</span>      <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_ytd_payment</span>  <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_payment_cnt</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">c_delivery_cnt</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="n">c_street_1</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">c_street_2</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">c_city</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="n">c_state</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_zip</span>          <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
     <span class="n">c_phone</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
     <span class="n">c_since</span>        <span class="nb">timestamp</span><span class="p">,</span>
     <span class="n">c_middle</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">c_data</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">c_w_id</span><span class="p">,</span> <span class="n">c_d_id</span><span class="p">,</span> <span class="n">c_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">c_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_history</span> <span class="p">(</span>
     <span class="n">hist_id</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_c_id</span>   <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_c_d_id</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_c_w_id</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_d_id</span>   <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_w_id</span>   <span class="nb">integer</span><span class="p">,</span>
     <span class="n">h_date</span>   <span class="nb">timestamp</span><span class="p">,</span>
     <span class="n">h_amount</span> <span class="nb">decimal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">h_data</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">h_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_new_order</span> <span class="p">(</span>
     <span class="n">no_w_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span> <span class="p">,</span>
     <span class="n">no_d_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">no_o_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">no_w_id</span><span class="p">,</span> <span class="n">no_d_id</span><span class="p">,</span> <span class="n">no_o_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">no_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_oorder</span> <span class="p">(</span>
     <span class="n">o_w_id</span>       <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">o_d_id</span>       <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">o_id</span>         <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">o_c_id</span>       <span class="nb">integer</span><span class="p">,</span>
     <span class="n">o_carrier_id</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="n">o_ol_cnt</span>     <span class="nb">integer</span><span class="p">,</span>
     <span class="n">o_all_local</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">o_entry_d</span>    <span class="nb">timestamp</span><span class="p">,</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">o_w_id</span><span class="p">,</span> <span class="n">o_d_id</span><span class="p">,</span> <span class="n">o_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">o_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_order_line</span> <span class="p">(</span>
     <span class="n">ol_w_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">ol_d_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">ol_o_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">ol_number</span>       <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">ol_i_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">ol_delivery_d</span>   <span class="nb">timestamp</span><span class="p">,</span>
     <span class="n">ol_amount</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">ol_supply_w_id</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">ol_quantity</span>     <span class="nb">integer</span><span class="p">,</span>
     <span class="n">ol_dist_info</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ol_w_id</span><span class="p">,</span> <span class="n">ol_d_id</span><span class="p">,</span> <span class="n">ol_o_id</span><span class="p">,</span> <span class="n">ol_number</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">ol_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_item</span> <span class="p">(</span>
     <span class="n">i_id</span>     <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">i_name</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">i_price</span>  <span class="nb">decimal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
     <span class="n">i_data</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
     <span class="n">i_im_id</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">i_id</span><span class="p">)</span>
   <span class="p">)</span> <span class="n">locality</span><span class="o">=</span><span class="s1">'F,R{all_server}@zone0, F,R{all_server}@zone1, F,R{all_server}@zone2'</span>  <span class="n">duplicate_scope</span><span class="o">=</span><span class="s1">'cluster'</span><span class="p">;</span>
   <span class="c1">-- );</span>
     
   <span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_stock</span> <span class="p">(</span>
     <span class="n">s_w_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">s_i_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
     <span class="n">s_quantity</span>   <span class="nb">integer</span><span class="p">,</span>
     <span class="n">s_ytd</span>        <span class="nb">integer</span><span class="p">,</span>
     <span class="n">s_order_cnt</span>  <span class="nb">integer</span><span class="p">,</span>
     <span class="n">s_remote_cnt</span> <span class="nb">integer</span><span class="p">,</span>
     <span class="n">s_data</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
     <span class="n">s_dist_01</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_02</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_03</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_04</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_05</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_06</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_07</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_08</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_09</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="n">s_dist_10</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
     <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">s_w_id</span><span class="p">,</span> <span class="n">s_i_id</span><span class="p">)</span>
   <span class="p">)</span><span class="n">tablegroup</span><span class="o">=</span><span class="s1">'tpcc_group'</span> <span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">s_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
     
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="五实验过程">五、实验过程</h2>

<h3 id="1-创建schema并在本地生成数据文件">1. 创建schema并在本地生成数据文件</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>benchmark-5.0/run
./runDatabaseBuild.sh props.ob
</code></pre></div></div>
<h3 id="2-导入数据">2. 导入数据</h3>

<ul>
  <li>这里采用的是外部load infile方式导入数据库，因为我们导入的数据量比较大，这种方式更加快速。首先，需要将生成的数据文件如customer.csv等移动到rootserver所在的机器上，我们这边放在10.24.14.245(rootserver)上的/data/ob/tpcc_100/目录。此外，schema的创建方式</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/warehouse.csv' into table bmsql_warehouse fields terminated by ',';"</span>  
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/district.csv' into table bmsql_district fields terminated by ',';"</span>  
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/config.csv' into table bmsql_config fields terminated by ',';"</span> 
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/item.csv' into table bmsql_item fields terminated by ',';"</span>  
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/order.csv' into table bmsql_oorder fields terminated by ',';"</span>  
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/stock.csv' into table bmsql_stock fields terminated by ',';"</span> 
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/cust-hist.csv' into table bmsql_history fields terminated by ',';"</span> 
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/new-order.csv' into table bmsql_new_order fields terminated by ',';"</span> 
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/order-line.csv' into table bmsql_order_line fields terminated by ',';"</span> 
obclient <span class="nt">-h10</span>.24.14.245 <span class="nt">-P2883</span> <span class="nt">-uroot</span>@test <span class="nt">-c</span>  <span class="nt">-D</span> tpcc_100 <span class="nt">-e</span> <span class="s2">"load data /*+ parallel(80) */ infile '/data/ob/tpcc_100/customer.csv' into table bmsql_customer fields terminated by ',';"</span> 
</code></pre></div></div>
<h3 id="3-分布式事务比例实验的运行负载">3. 分布式事务比例实验的运行负载</h3>

<p>实验中分别将newOrderDistributedRate设为0.01，0.1，0.2，0.4，0.6，0.8，1 分别代表不同的NewOrder事务的分布式事务比例</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="o">/</span><span class="n">runBenchmark</span><span class="p">.</span><span class="n">sh</span> <span class="n">probs</span><span class="p">.</span><span class="n">ob</span>
</code></pre></div></div>

<h2 id="六实验结果展示与分析">六、实验结果展示与分析</h2>

<ul>
  <li>我们将上方运行的分布式事务的实验结果列在下方，横坐标是不同的分布式事务比例，纵坐标是每分钟的吞吐数。我们可以观察到，分布式事务比例从0.01一直到1，吞吐从188639下降到64699，下降了65.7%。实验结果符合我们的预期，分布式事务对分布式数据库的性能会造成比较大的影
响。</li>
  <li>为了尽量减少分布式事务比例的影响，OceanBase其实提出了tablegroup机制，它能让经常被一起访问的记录尽可能地放在用一个partition中。比如，一个歌手名下有多张唱片，那么如果一个事务更新歌手及其名下的唱片，那么将该歌手和其唱片放在一起，就可以减少分布式事务。OceanBase中的tablegroup机制就是基于这样的想法创建出来的，为了验证tablegroup机制提升性能的效果，我们将去掉原始的tablegroup机制，来看性能下降了多少。</li>
</ul>

<p><img src="/auto-image/picrepo/b4c987fe-f308-492b-aa36-399ecede06b7.png" alt="imgalt"></p>

<h2 id="七进一步实验">七、进一步实验</h2>

<ul>
  <li>
    <p>为了完成这个实验，需要修改benchmark-5.0/run/sql.oceanbase/tableCreates.sql 文件。</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_config</span> <span class="p">(</span>
  <span class="n">cfg_name</span>    <span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
  <span class="n">cfg_value</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>
  
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_warehouse</span> <span class="p">(</span>
  <span class="n">w_id</span>        <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">w_ytd</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">w_tax</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
  <span class="n">w_name</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">w_street_1</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">w_street_2</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">w_city</span>      <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">w_state</span>     <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">w_zip</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
  <span class="k">primary</span> <span class="k">key</span><span class="p">(</span><span class="n">w_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_district</span> <span class="p">(</span>
  <span class="n">d_w_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">d_id</span>         <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">d_ytd</span>        <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">d_tax</span>        <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
  <span class="n">d_next_o_id</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">d_name</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">d_street_1</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">d_street_2</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">d_city</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">d_state</span>      <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">d_zip</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">d_w_id</span><span class="p">,</span> <span class="n">d_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">d_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_customer</span> <span class="p">(</span>
  <span class="n">c_w_id</span>         <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">c_d_id</span>         <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">c_id</span>           <span class="nb">integer</span>        <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">c_discount</span>     <span class="nb">decimal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
  <span class="n">c_credit</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_last</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
  <span class="n">c_first</span>        <span class="nb">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
  <span class="n">c_credit_lim</span>   <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_balance</span>      <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_ytd_payment</span>  <span class="nb">decimal</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_payment_cnt</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">c_delivery_cnt</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">c_street_1</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">c_street_2</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">c_city</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">c_state</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_zip</span>          <span class="nb">char</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
  <span class="n">c_phone</span>        <span class="nb">char</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span>
  <span class="n">c_since</span>        <span class="nb">timestamp</span><span class="p">,</span>
  <span class="n">c_middle</span>       <span class="nb">char</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">c_data</span>         <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">c_w_id</span><span class="p">,</span> <span class="n">c_d_id</span><span class="p">,</span> <span class="n">c_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">c_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_history</span> <span class="p">(</span>
  <span class="n">hist_id</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_c_id</span>   <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_c_d_id</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_c_w_id</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_d_id</span>   <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_w_id</span>   <span class="nb">integer</span><span class="p">,</span>
  <span class="n">h_date</span>   <span class="nb">timestamp</span><span class="p">,</span>
  <span class="n">h_amount</span> <span class="nb">decimal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">h_data</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">h_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_new_order</span> <span class="p">(</span>
  <span class="n">no_w_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span> <span class="p">,</span>
  <span class="n">no_d_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">no_o_id</span>  <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">no_w_id</span><span class="p">,</span> <span class="n">no_d_id</span><span class="p">,</span> <span class="n">no_o_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">no_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_oorder</span> <span class="p">(</span>
  <span class="n">o_w_id</span>       <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">o_d_id</span>       <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">o_id</span>         <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">o_c_id</span>       <span class="nb">integer</span><span class="p">,</span>
  <span class="n">o_carrier_id</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">o_ol_cnt</span>     <span class="nb">integer</span><span class="p">,</span>
  <span class="n">o_all_local</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">o_entry_d</span>    <span class="nb">timestamp</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">o_w_id</span><span class="p">,</span> <span class="n">o_d_id</span><span class="p">,</span> <span class="n">o_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">o_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_order_line</span> <span class="p">(</span>
  <span class="n">ol_w_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">ol_d_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">ol_o_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">ol_number</span>       <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">ol_i_id</span>         <span class="nb">integer</span>   <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">ol_delivery_d</span>   <span class="nb">timestamp</span><span class="p">,</span>
  <span class="n">ol_amount</span>       <span class="nb">decimal</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">ol_supply_w_id</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">ol_quantity</span>     <span class="nb">integer</span><span class="p">,</span>
  <span class="n">ol_dist_info</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ol_w_id</span><span class="p">,</span> <span class="n">ol_d_id</span><span class="p">,</span> <span class="n">ol_o_id</span><span class="p">,</span> <span class="n">ol_number</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">ol_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_item</span> <span class="p">(</span>
  <span class="n">i_id</span>     <span class="nb">integer</span>      <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">i_name</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">i_price</span>  <span class="nb">decimal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">i_data</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="n">i_im_id</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">i_id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">locality</span><span class="o">=</span><span class="s1">'F,R{all_server}@zone0, F,R{all_server}@zone1, F,R{all_server}@zone2'</span>  <span class="n">duplicate_scope</span><span class="o">=</span><span class="s1">'cluster'</span><span class="p">;</span>
<span class="c1">-- );</span>
  
<span class="k">create</span> <span class="k">table</span> <span class="n">bmsql_stock</span> <span class="p">(</span>
  <span class="n">s_w_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">s_i_id</span>       <span class="nb">integer</span>       <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
  <span class="n">s_quantity</span>   <span class="nb">integer</span><span class="p">,</span>
  <span class="n">s_ytd</span>        <span class="nb">integer</span><span class="p">,</span>
  <span class="n">s_order_cnt</span>  <span class="nb">integer</span><span class="p">,</span>
  <span class="n">s_remote_cnt</span> <span class="nb">integer</span><span class="p">,</span>
  <span class="n">s_data</span>       <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="n">s_dist_01</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_02</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_03</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_04</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_05</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_06</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_07</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_08</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_09</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="n">s_dist_10</span>    <span class="nb">char</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">s_w_id</span><span class="p">,</span> <span class="n">s_i_id</span><span class="p">)</span>
<span class="p">)</span><span class="k">partition</span> <span class="k">by</span> <span class="n">hash</span><span class="p">(</span><span class="n">s_w_id</span><span class="p">)</span> <span class="n">partitions</span> <span class="mi">128</span><span class="p">;</span>
  
</code></pre></div>    </div>
  </li>
  <li>
    <p>为了简化实验，这边将props.ob中的变量newOrderDistributedRate=0.01</p>
  </li>
  <li>
    <p>加载数据&amp;运行负载</p>
  </li>
  <li>
    <p>实验展示与分析</p>

    <ul>
      <li>我们将运行的实验结果列在下方，横坐标是两种不同的schema方法，纵坐标表是NewOrder事务的每分钟的吞吐。我们可以看到不建立tablegroup的时候，吞吐为61977，而建立tablegroup之后，吞吐提高了3倍左右，为188639。可见，OceanBase提供的tablegroup机制能大大提升性能。</li>
    </ul>
  </li>
</ul>

<p><img src="/auto-image/picrepo/475c03c0-3083-4eeb-a4d2-942b246ae6f5.png" alt="imgalt"></p>

<h2 id="八总结">八、总结</h2>

<ul>
  <li>经过上方的实验，我们可以将OceanBase在分布式事务的支持能力上的实验表现总结为两点：
    <ul>
      <li>在良好分区下，OceanBase能提供非常高的吞吐，表现十分优异。随着分布式事务比例的增长，OceanBase的性能会呈现下降的趋势，这也是大多数分布式事务型数据库所面临的难题和挑战<sup id="fnref:1"><a href="#fn:1" class="footnote" rel="footnote" role="doc-noteref">1</a></sup><sup id="fnref:2"><a href="#fn:2" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>。</li>
      <li>OceanBase所提供的tablegroup技术能够迎合业务的需求，就数据和业务进行良好的绑定。在我们的实验中，加入tablegroup机制让整个吞吐上升了整整3倍。</li>
    </ul>
  </li>
</ul>

<h2 id="参考文献">参考文献</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1">
      <p><span name="ref1">Pavlo A, Curino C, Zdonik S. Skew-aware automatic database partitioning in shared-nothing, parallel OLTP systems[C]//Proceedings of the 2012 ACM SIGMOD International Conference on Management of Data. 2012: 61-72.</span> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
    <li id="fn:2">
      <p>L. Qu, Q. Wang, T. Chen, K. Li, R. Zhang, X. Zhou, Q. Xu, Z. Yang, C. Yang, W. Qian, and A. Zhou, “Are current benchmarks adequate to evaluate distributed transactional databases?” BenchCouncil Transactions on Benchmarks, Standards and Evaluations, vol. 2, no. 1,p. 100031, 2022. [Online]. Available: https://www.sciencedirect.com/science/article/pii/S2772485922000187 <a href="#fnref:2" class="reversefootnote" role="doc-backlink">↩</a></p>
    </li>
  </ol>
</div>
  </section>

  
  
  

  <section class="background" data-size="page">
    <!--
  background: ;
  dark: ;
  size: ;
-->


<div class="post-nav">
  <span>
    
      <i class="icon fa-solid fa-angle-left"></i> Previous post<br>
      <a href="/2022/03/30/OceanBase%E8%BF%9E%E6%8E%A5%E9%A1%BA%E5%BA%8F%E9%80%89%E6%8B%A9%E7%9A%84%E4%BC%98%E5%8A%A3%E8%AF%84%E4%BC%B0.html">
        OceanBase连接顺序选择的优劣评估
      </a>
    
  </span>
  <span>
    
      Next post <i class="icon fa-solid fa-angle-right"></i><br>
      <a href="/2022/05/11/OceanBase%E5%86%85%E6%A0%B8%E5%88%9D%E6%8E%A2.html">
        OceanBase内核初探
      </a>
    
  </span>
</div>
  </section>


    </main>
    


<footer class="background" style="--image: url('')" data-dark="true" data-size="wide">
  <!--
    <div>
      Extra details like contact info or address
    </div>
  -->

  <div>
    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="mailto:rzhang@dase.ecnu.edu.cn" data-tooltip="Email" data-style="bare" aria-label="Email">
      <i class="icon fa-solid fa-envelope"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="tel:021-62235006" data-tooltip="Phone number" data-style="bare" aria-label="Phone number">
      <i class="icon fa-solid fa-phone"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://orcid.org/0000-0002-5182-2093" data-tooltip="ORCID" data-style="bare" aria-label="ORCID">
      <i class="icon fa-brands fa-orcid"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://scholar.google.com/citations?user=iJtZsaQAAAAJ" data-tooltip="Google Scholar" data-style="bare" aria-label="Google Scholar">
      <i class="icon fa-brands fa-google"></i>
      
    </a>
  </div>


    
      
      
      



  <div class="button-wrapper">
    <a class="button" href="https://github.com/dbhammer" data-tooltip="GitHub" data-style="bare" aria-label="GitHub">
      <i class="icon fa-brands fa-github"></i>
      
    </a>
  </div>


    
  </div>

  <div>
    © 2025
    DBHammer
      |   Built with
    <a href="https://github.com/greenelab/lab-website-template">
      Lab Website Template
    </a>
  </div>

  <input type="checkbox" class="dark-toggle" data-tooltip="Dark mode" aria-label="toggle dark mode" oninput="onDarkToggleChange(event)">
</footer>

  </body>
</html>
